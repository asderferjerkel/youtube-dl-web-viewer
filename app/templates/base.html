<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		{% if title %}
			<title>{{ title }} | youtube-dl-web-viewer</title>
		{% else %}
			<title>youtube-dl-web-viewer</title>
		{% endif %}
	<link rel="stylesheet" href="{{ url_for('static', filename = 'style.css') }}">
	<script>
		var csrf_token = "{{ csrf_token() }}";
		var api_url = "/api/";
		
		function addMessage(message) {
			var parent = document.getElementById("notifications");
			var notification = document.createElement("li");
			notification.className = "notification";
			notification.innerHTML = message;
			parent.append(notification);
		};
		
		function loadJSON(endpoint, callback) {
			var args = Array.prototype.slice.call(arguments, 2);
			var xhr = new XMLHttpRequest();
			
			xhr.ontimeout = function () {
				addMessage("Request timed out: " + api_url + endpoint);
			};
			xhr.onload = function() {
				if (xhr.readyState === 4) {
					try {
						var response = JSON.parse(xhr.responseText);
					} catch(e) {
						console.error("Error parsing JSON response: " + xhr.responseText)
					};
					if (response !== undefined) {
						if (xhr.status === 200) {
							callback.apply(response, args);
						} else {
							addMessage(response.message);
						};
					};
				};
			};
			
			xhr.open("GET", api_url + endpoint, true);
			xhr.setRequestHeader("X-CSRFToken", csrf_token);
			xhr.timeout = "10000";
			xhr.send(null);
		};
		
		document.addEventListener("DOMContentLoaded", (event) => {
			document.querySelectorAll(".message").forEach(function(element) {
				element.querySelector(".controls button").addEventListener("click", () => {
					element.classList.add("collapsed");
				});
			});
		});
	</script>
	</head>
	
	<body>
		<ul id="notifications"></ul>
		
		<div class="container">
			<header>
				<h1><a href="{{ url_for('index.index') }}" aria-label="Home">yt-dl web</a></h1>
				<nav class="navigation">
				{% if g.user %}
					<div class="user">
						<ul>
							<li><a href="{{ url_for('settings.user') }}">{{ g.user['username'] }}</a></li>
							<li><a href="{{ url_for('auth.logout') }}">Logout</a></li>
						</ul>
					</div>
					{% if g.user['is_admin'] == 1 %}
						<div class="pages">
							<ul>
							{% for item in nav.top %}
								<li class="{{ 'active' if item.is_active }}">
									<a href="{{ item.url }}">{{ item.label }}</a>
								</li>
							{% endfor %}
							</ul>
						</div>
					{% endif %}
				{% else %}
					<div class="user">
						<ul>
							<li><a href="{{ url_for('auth.login') }}">Login</a></li>
						</ul>
					</div>
				{% endif %}
				</nav>
			</header>
			
			<section class="messages">
			{% with messages = get_flashed_messages() %}
				{% if messages %}
					{% for message in messages %}
						<div class="message">
							<div class="content">{{ message }}</div>
							<div class="controls"><button class="close" aria-label="Dismiss">X</button></div>
						</div>
					{% endfor %}
				{% endif %}
			{% endwith %}
			</section>
			
			{% block content %}{% endblock %}
		</div>
	</body>
</html>